<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Night's Watch</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <meta name="description" content="Sword in the darkness">
  <meta name="keywords" content="Night's Watch, system, monitor, arduino, go, golang, vue, vuejs">
  <meta name="author" content="Quy Le (lnquy)">
  <meta name="contact" content="lnquy.it@gmail.com">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons" rel="stylesheet">
  <link href="static/css/vuetify.min.css" rel="stylesheet">
  <link href="static/css/nw.css" rel="stylesheet">
</head>
<body>
<div id="app">
  <v-app dark>
    <v-content>
      <!--Toolbar-->
      <v-toolbar dark color="black">
        <!--<v-toolbar-side-icon></v-toolbar-side-icon>-->
        <img src="static/img/nw.png" width="40"/>
        <v-toolbar-title class="white--text light-font hidden-xs-only">Night's Watch</v-toolbar-title>
        <v-spacer></v-spacer>
        <v-btn class="mr-0" color="info" @click="" :disabled="!isConfigChanged">
          <v-icon small>save</v-icon>
          &nbsp;&nbsp;Save
        </v-btn>
        <v-menu bottom lazy>
          <v-btn icon slot="activator">
            <v-icon>more_vert</v-icon>
          </v-btn>
          <v-list>
            <v-list-tile v-for="(m, idx) in menus" :key="idx" @click="clickMenuItem(idx)">
              <v-icon>{{ m.icon }} &nbsp;&nbsp;&nbsp;</v-icon>
              <v-list-tile-title>{{ m.text}}</v-list-tile-title>
            </v-list-tile>
            <v-divider></v-divider>
            <v-list-tile @click="">
              <v-icon>keyboard_return &nbsp;&nbsp;&nbsp;</v-icon>
              <v-list-tile-title>Logout</v-list-tile-title>
            </v-list-tile>
          </v-list>
        </v-menu>
      </v-toolbar>
      <!--Main content-->
      <v-container fluid>
        <!--Serial card-->
        <v-layout justify-center>
          <v-flex class="xs12 sm8">
            <v-card>
              <v-card-title class="headline">
                <v-layout>
                  <v-flex class="xs12">
                    <span class="green-accent-3">Serial</span>
                    <v-tooltip bottom>
                      <v-icon small slot="activator" style="color: rgba(255,255,255,.61)">info_outline</v-icon>
                      <span>Configure the serial port which connects to Arduino board.<br/>Also the baud rate (default 9600).</span>
                    </v-tooltip>
                    <v-tooltip top>
                      <v-btn class="ma-0" flat fab small style="float: right" @click="loadSerialPorts" slot="activator">
                        <v-icon>refresh</v-icon>
                      </v-btn>
                      <span>Refresh serial ports</span>
                    </v-tooltip>
                  </v-flex>
                </v-layout>
              </v-card-title>
              <v-card-text class="pt-0">
                <v-layout>
                  <v-flex class="xs7 sm9 pr-3">
                    <v-select
                        :items="slSerialPorts" v-model="cfg.serial.port" label="Select serial port" single-line
                        bottom light solo required no-data-text="No serial ports found"
                        hint="Serial Port" persistent-hint>
                    </v-select>
                  </v-flex>
                  <v-flex class="xs5 sm3">
                    <v-select
                        :items="slSerialBauds" v-model="cfg.serial.baud" label="Select baud rate" single-line
                        bottom light solo required hint="Baud Rate" persistent-hint>
                    </v-select>
                  </v-flex>
                </v-layout>
              </v-card-text>
            </v-card>
          </v-flex>
        </v-layout>

        <!--Stats card-->
        <v-layout class="mt-3" justify-center>
          <v-flex class="xs12 sm8">
            <v-card>
              <v-card-title class="headline">
                <v-layout>
                  <v-flex class="xs12">
                    <span class="green-accent-3">Statistics</span>
                    <v-tooltip bottom>
                      <v-icon small slot="activator" style="color: rgba(255,255,255,.61)">info_outline</v-icon>
                      <span>Configure system statistics and alert thresholds.<br>Set value to <span style="color: #00E676"><b>0</b></span> to disable the alert.</span>
                    </v-tooltip>
                  </v-flex>
                </v-layout>
              </v-card-title>
              <v-card-text class="pt-0">
                <span class="subheading green-secondary">CPU</span><br>
                <v-layout class="mt-2">
                  <v-flex class="xs6 pr-3">
                    <v-text-field class="vtf-right" type="number" min="0" max="100" label="Load threshold" v-model="cfg.stats.cpu.load" suffix="%"></v-text-field>
                  </v-flex>
                  <v-flex class="xs6">
                    <v-text-field class="vtf-right" type="number" min="0" max="100" label="Temperature threshold" v-model="cfg.stats.cpu.temp" suffix="Â°C"></v-text-field>
                  </v-flex>
                </v-layout>

                <span class="subheading green-secondary">Memory</span><br>
                <v-layout class="mt-2">
                  <v-flex class="xs12">
                    <v-text-field class="vtf-right" type="number" min="0" max="100" label="Load threshold" v-model="cfg.stats.mem.load" suffix="%"></v-text-field>
                  </v-flex>
                </v-layout>

                <span class="subheading green-secondary">GPU</span><br>
                <v-layout class="mt-2">
                  <v-flex class="xs6 pr-3">
                    <v-text-field class="vtf-right" type="number" min="0" max="100" label="Load threshold" v-model="cfg.stats.gpu.load" suffix="%"></v-text-field>
                  </v-flex>
                  <v-flex class="xs6">
                    <v-text-field class="vtf-right" type="number" min="0" max="100000" label="Usage threshold" v-model="cfg.stats.gpu.usage" suffix="MB"></v-text-field>
                  </v-flex>
                </v-layout>

                <span class="subheading green-secondary">Network</span><br>
                <v-layout class="mt-2">
                  <v-flex class="xs6 pr-3">
                    <v-text-field class="vtf-right" type="number" min="0" max="1000000" label="Download threshold" v-model="cfg.stats.net.download" suffix="KB/s"></v-text-field>
                  </v-flex>
                  <v-flex class="xs6">
                    <v-text-field class="vtf-right" type="number" min="0" max="1000000" label="Upload threshold" v-model="cfg.stats.net.upload" suffix="KB/s"></v-text-field>
                  </v-flex>
                </v-layout>
              </v-card-text>
            </v-card>
          </v-flex>
        </v-layout>

        <!--SleepTime card-->
        <v-layout class="mt-3" justify-center>
          <v-flex class="xs12 sm8">
            <v-card>
              <v-card-title class="headline">
                <v-layout>
                  <v-flex class="xs12">
                    <span class="green-accent-3">Sleep Time</span>
                    <v-tooltip bottom>
                      <v-icon small slot="activator" style="color: rgba(255,255,255,.61)">info_outline</v-icon>
                      <span>Configure the sleep time duration.
                        <br/>Server won't send system statistics to Arduino board and also turn off the LCD in sleep time.
                        <br/>Set both start time and end time to <span style="color: #00E676"><b>00:00</b></span> to disable sleep time.
                      </span>
                    </v-tooltip>
                  </v-flex>
                </v-layout>
              </v-card-title>
              <v-card-text class="pt-0">
                <v-layout>
                  <v-flex class="xs6 pr-3">
                    <v-menu ref="startMenu" lazy :close-on-content-click="false" transition="scale-transition"
                        offset-y full-width :nudge-right="40" max-width="290px" min-width="290px" :return-value.sync="cfg.sleep.start">
                      <v-text-field slot="activator" label="Pick start time" v-model="cfg.sleep.start" prepend-icon="timer" readonly></v-text-field>
                      <v-time-picker v-model="cfg.sleep.start" @change="$refs.startMenu.save(cfg.sleep.start)"></v-time-picker>
                    </v-menu>
                  </v-flex>
                  <v-flex class="xs6">
                    <v-menu ref="endMenu" lazy :close-on-content-click="false" transition="scale-transition"
                            offset-y full-width :nudge-right="40" max-width="290px" min-width="290px" :return-value.sync="cfg.sleep.end">
                      <v-text-field slot="activator" label="Pick end time" v-model="cfg.sleep.end" prepend-icon="timer_off" readonly></v-text-field>
                      <v-time-picker v-model="cfg.sleep.end" @change="$refs.endMenu.save(cfg.sleep.end)"></v-time-picker>
                    </v-menu>
                  </v-flex>
                </v-layout>
              </v-card-text>
            </v-card>
          </v-flex>
        </v-layout>
      </v-container>
    </v-content>
  </v-app>
</div>

<!--Scripts-->
<script src="static/js/vuejs.dev.js"></script> <!--TODO-->
<script src="static/js/vuetify.min.js"></script>
<script src="static/js/axios.min.js"></script>
<script>
  new Vue({
    el: '#app',
    data: {
      cfg: {
        serial: {
          port: '',
          baud: 9600
        },
        stats: {
          cpu: {
            load: 0,
            temp: 0
          },
          mem: {
            load: 0
          },
          gpu: {
            load: 0,
            usage: 0
          },
          net: {
            download: 0,
            upload: 0
          }
        },
        sleep: {
          start: '00:00',
          end: '00:00'
        }
      },
      menus: [
        {icon: 'launch', text: 'Source code'},
        {icon: 'language', text: 'Languages'},
        {icon: 'account_circle', text: 'Change admin info'}
      ],
      slSerialPorts: [],
      slSerialBauds: [
        {text: '300', value: 300},
        {text: '1200', value: 1200},
        {text: '2400', value: 2400},
        {text: '4800', value: 4800},
        {text: '9600', value: 9600},
        {text: '19200', value: 19200},
        {text: '38400', value: 38400},
        {text: '57600', value: 57600},
        {text: '74880', value: 74880},
        {text: '115200', value: 115200},
        {text: '230400', value: 230400},
        {text: '250000', value: 250000}
      ],
      isConfigChanged: false
    },
    watch : {
      cfg: {
        handler: function (newVal, oldVal) {
          this.isConfigChanged = true;
        },
        deep: true,
        immediate: true
      }
    },
    methods: {
      loadConfigs: function() {
        var self = this;
        self.slSerialPorts = [];
        self.cfg.serial.port = '';
        axios.get('/api/v1/config')
            .then(function (res) {
              // TODO: Map response to this.cfg
              console.log(res.data)
            })
            .catch(function (err) {
              console.log(err);
            });

      },
      loadSerialPorts: function () {
        var self = this;
        self.slSerialPorts = [];
        self.cfg.serial.port = '';
        axios.get('/api/v1/serial')
            .then(function (res) {
              self.slSerialPorts = res.data;
            })
            .catch(function (err) {
              console.log(err);
            });

      }
    },
    mounted: function () {
      this.loadSerialPorts();
      this.loadConfigs();
    }
  })
</script>
</body>
</html>
